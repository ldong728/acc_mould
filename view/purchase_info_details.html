<div class="home">
    <div class="container">
        <div class="pu-container">
            <div class="pu-breadcrumbs clearfix">
                <ul class="clearfix">
                    <li><a href="?href=index">首页</a></li>
                    <span>&gt;</span>
                    <li><a href="?href=mold_bidding">模具招投标</a></li>
                    <span>&gt;</span>
                    <li><a href="?href=bidding_details" class="bidding-content" data-field="bidding_title"></a></li>
                </ul>
            </div>
            <div class="pu-company-box clearfix">
                <div class="pu-company-l">
                    <h3 class="title bidding-content" data-field="company_name"><img src="images/vip.jpg"></h3>

                    <p class="text"><span class="color8">所在地区：</span><i class="bidding-content"
                                                                        data-field="company_address"></i></p>

                    <p class="more-need">
                        <!--<a href="#" class="clearfix"><span>更多Ta的采购需求</span><i class="icon icon-angle-double-right"></i> </a>-->
                    </p>
                </div>
                <div class="pu-company-r">
                    <a href="?href=bidding_release" class="clearfix">
                        <img src="images/text1.png">
                        <span class="cur-color">我也要发布招标</span>
                    </a>
                </div>
            </div>
            <div class="pu-parameter">
                <h2 class="pu-parameter-title"></h2>
                <div class="pi-message">
                    <div class="pi-top">
                        <div class="pi-top-t clearfix">
                            <div class="li">
                                <p class="text">报价数</p>
                                <p class="light">3<span>个</span></p>
                            </div>
                            <div class="li">
                                <p class="text">被查看次数</p>
                                <p class="light">500<span>次</span></p>
                            </div>
                            <!--<div class="li">-->
                                <!--<p class="text">采购数量</p>-->
                                <!--<p class="light">3<span>种</span></p>-->
                            <!--</div>-->
                            <div class="li">
                                <span class="circle"></span>
                                <button type="button" class="btn">立即报价</button>
                                <span class="text">距离报价结束还剩<i class="day-last">0</i>天</span>
                            </div>
                        </div>
                        <div class="pi-top-m clearfix">
                            <div class="li">
                                <p class="text">报价截止日期</p>
                                <p class="content">2017.12.31</p>
                            </div>
                            <div class="li">
                                <p class="text">信息发布日期</p>
                                <p class="content">2017.12.01</p>
                            </div>
                            <div class="li">
                                <p class="text">图纸下载</p>
                                <p class="content cur-color">图纸.rar<i class="icon icon-arrow-circle-o-down"></i></p>
                            </div>
                            <div class="li">
                                <p class="text">采购单下载</p>
                                <p class="content cur-color">采购单.xlsx<i class="icon icon-arrow-circle-o-down"></i></p>
                            </div>
                        </div>
                        <div class="pi-top-b">
                            <div class="li">
                                <p class="title">备注</p>
                                <p class="text">期望交货日期：2017-12-22 ，交货方式：供应方送货，支付方式：现金支付</p>
                            </div>
                        </div>
                        <div class="pu-shopping">
                            <h3 class="title">采购商品</h3>
                            <div class="table">
                                <table width="100%" cellspacing="0" cellpadding="0" border="1" borderColor="#eee">
                                    <thead>
                                    <tr>
                                        <td>物品名称</td>
                                        <td>图片</td>
                                        <td>采购量</td>
                                        <td>规格属性</td>
                                        <td>其他备注</td>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>上模座</td>
                                        <td><img src="images/table1.jpg" ></td>
                                        <td><span class="light">2</span>吨</td>
                                        <td>1150*425*55</td>
                                        <td>材料45#</td>
                                    </tr>
                                    <tr>
                                        <td>下模座</td>
                                        <td><img src="images/table1.jpg" ></td>
                                        <td><span class="light">2</span>吨</td>
                                        <td>1150*425*55</td>
                                        <td>材料45#</td>
                                    </tr>
                                    <tr>
                                        <td>垫板</td>
                                        <td><img src="images/table1.jpg" ></td>
                                        <td><span class="light">2</span>吨</td>
                                        <td>1150*425*55</td>
                                        <td>材料45#</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="send-form send-bi">
    <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <thead>
        <tr>
            <td colspan="2">我的报价</td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>价格：</td>
            <td><input type="text" name="price"><span>元</span></td>
        </tr>
        <tr>
            <td>运费：</td>
            <td><input type="text" name="fee" class="tender-content" data-field="freight"><span>元</span></td>
        </tr>
        <tr>
            <td>报价单：</td>
            <td><input type="text" name="price" class="uploaded" readonly><span class="up upload-button"><i class="icon icon icon-arrow-circle-o-down"></i></span>
                <input type="hidden" class="tender-content" data-field="tender_attachment">
            </td>
        </tr>
        <tr>
            <td></td>
            <td><p class="info">* 上传excel详细报价单</p></td>
        </tr>
        <tr>
            <td></td>
            <td>
                <input type="submit" value="发送报价" class="btn submit-tender">
                <input type="reset" value="取消" class="btn reset">
            </td>
        </tr>
        </tbody>
    </table>
</div>
<input type="file" class="files" id="tender_file" name="tender_file" style="display: none">
<script>
    $(function () {
        sendQuote();

        function sendQuote() {
            $(document).on('click','.bidding-quote',function () {
                $('.send-form').show();
                $('body').append('<div class="mask"></div>');
                var bodyHeight = $('body').height();
                console.log(bodyHeight);
                $('.mask').height(bodyHeight);
            });
            $(document).on('click','.reset',function () {
                $('.mask').remove();
                $('.send-form').hide();
            });
            $(document).on('click','.mask',function(){
                $('.mask').remove();
                $('.send-form').hide();
            });
        }

    })
</script>
<script>
    var id = getUrlParam('id');
    $(document).ready(function () {
        registEvent();
        initBidding(id);
        setUpload();
    });


    function registEvent() {
        $(document).on('click', '.upload-button', function () {
            $('#tender_file').click();
        });
        $(document).on('click', '.submit-tender', function () {
            var data = {bidding_inquiry: id};
            $('.tender-content').each(function(k,v){
                var field=$(v).data('field');
                data[field]=$(v).val();
            });
            console.log(data);
            ajaxPost('Bidding', 'add_tender', data, function (back) {
                backHandle(back, function (data) {
                    location.reload(true);
                }, function (errCode, errMsg) {
                    alert(errMsg);
                });
            });
            console.log(data);
        });
    }
    function initBidding(id, callback) {
        ajaxPost('Bidding', 'bidding_inquiry_detail', {id: id}, function (back) {
            backHandle(back, initContent, function (code, msg) {
                switch (code) {
                    case 101:
                        location.href = '?href=login';
                        break;
                    case 102:
                        location.href = '?href=pc_company_profile';
                        break;
                }
            });
            function initContent(backValue) {
                console.log(backValue);
                var inf = backValue['biddingInf'];
                $('.bidding-content').each(function (k, v) {
                    var field = $(this).data('field');
                    $(this).removeAttr('data-attr');
                    $(this).text(inf[field] || '');
                });
                $('.attachment').attr('href',inf.attachment);
                $('.attachment').attr('href', inf.attachment);
//                        inf.start_time_unix=inf.start_time_unix||0;
//                        console.log(inf.start_time_unix);
                var nowTime = parseInt((new Date().getTime()) / 1000);
                console.log(nowTime);
                var dayLast = parseInt((parseInt(inf.end_time_unix) - nowTime) / 24 / 3600);
                if (dayLast > 0) {
                    $('.day-last').text(dayLast);
                } else {
                    $('.bidding-status').text('已完成');
                    $('.action-button').remove();
                }
                if (backValue.record) {
                    $('.bidding-status').text('已报价');
                    $('.action-button').remove();
                }
                var companyInf = backValue['companyInf'];
                $('.company-content').each(function (k, v) {
                    var field = $(v).data('field');
                    $(v).val(companyInf[field]);
                    $(v).removeAttr('data-field');
                });
                var tenders=backValue['tenders'];
                var tendersCreator=prepareElement('.tendered-template');
                console.log(tenders);
                if(tenders){
                    $.each(tenders,function(k,v){
                        var element=tendersCreator();
                        element.find('.tendered-content').each(function(id,subElement){
                            var field=$(subElement).data('field');
                            $(subElement).text(v[field]);
                        });
                        $('.tendered-container').append(element);
                    })
                }
            }


            if (callback)callback();
        });
    }

    function setUpload() {
        setUploadEvent('#tender_file', function (data) {
            $('.uploaded').val(data.originalName);
            $('.file-url').val(data.url);
            console.log(data);
        });
    }
</script>